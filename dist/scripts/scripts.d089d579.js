"use strict";function existsIn(a,b){var c=!1;return b.forEach(function(b){0===b.localeCompare(a)&&(c=!0)}),c}angular.module("cCheckApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ui.bootstrap","ngDialog"]).config(["$routeProvider",function(a){a.when("/main",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).when("/login",{templateUrl:"views/login.html",controller:"LoginCtrl"}).when("/unauthorized",{templateUrl:"views/unauthorized.html"}).when("/addTrainee",{templateUrl:"views/addtrainee.html",controller:"AddFightersCtrl"}).when("/allTrainees",{templateUrl:"views/allfighters.html",controller:"AllFightersCtrl"}).when("/addSession",{templateUrl:"views/addsession.html",controller:"AddSessionCtrl"}).when("/allSessions",{templateUrl:"views/allsessions.html",controller:"AllSessionsCtrl"}).otherwise({redirectTo:"/about"})}]).constant("API_URL","https://ccheckapi.herokuapp.com/").run(["$rootScope","$location","authService",function(a,b,c){var d=["/","/login","/about"],e=["/addTrainee","/allTrainees","/addSession","/allSessions"];a.$on("$routeChangeError",function(a,c,d,e){e.authenticated===!1&&b.path("/login")}),a.$on("$routeChangeStart",function(){var a=b.path();existsIn(a,d)||c.loggedIn()?existsIn(a,e)&&!existsIn("trainer",c.permissions())&&b.path("/unauthorized"):b.path("/login")})}]).config(["$httpProvider",function(a){a.interceptors.push("authInterceptor")}]).config(["$resourceProvider",function(a){a.defaults.stripTrailingSlashes=!1}]).config(["datepickerConfig",function(a){a.showButtonBar=!1}]).controller("NavController",["$scope","$location","authService",function(a,b,c){a.isActive=function(a){return a===b.path()},a.logout=function(){c.logout(),b.path("/login")},a.loggedIn=function(){return c.loggedIn()?!0:!1},a.user=c.getUser(),a.isTrainer=function(){return existsIn("trainer",c.permissions())}}]),angular.module("cCheckApp").controller("MainCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("cCheckApp").controller("AboutCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("cCheckApp").controller("LoginCtrl",["$scope","$location","authService",function(a,b,c){a.user="",a.pass="",a.login=function(){c.login(a.user,a.pass).then(function(){b.path("/")})}}]),angular.module("cCheckApp").factory("authService",["$http","$q","$window","API_URL",function(a,b,c,d){function e(){return k}function f(e,f){var g=b.defer();return a.post(d+"api-token-auth/",{username:e,password:f}).then(function(a){k=a.data,c.sessionStorage.setItem("user",JSON.stringify(k)),l=!0,g.resolve(k)},function(a){g.reject(a)}),g.promise}function g(){c.sessionStorage.user=null,k=null,l=!1}function h(){return l}function i(){return l?k.permissions:[]}function j(){c.sessionStorage.user&&(k=JSON.parse(c.sessionStorage.getItem("user")),k&&(l=!0))}var k,l=!1;return j(),{login:f,getUser:e,logout:g,loggedIn:h,permissions:i}}]),angular.module("cCheckApp").factory("authInterceptor",["$rootScope","$q","$window","$location",function(a,b,c,d){return{request:function(a){a.headers=a.headers||{};var b=JSON.parse(sessionStorage.getItem("user"));return b&&(a.headers.Authorization="Token "+b.token),a},response:function(a){return 401===a.status&&d.path("/login"),a||b.when(a)}}}]),angular.module("cCheckApp").factory("fighters",["$resource","API_URL",function(a,b){return a(b+"fighters/:id/",{id:"@id"},{update:{method:"PUT"}})}]).factory("users",["$resource","API_URL",function(a,b){return a(b+"users/:id",{id:"@id"},{update:{method:"PUT"}})}]).factory("sessions",["$resource","API_URL",function(a,b){return a(b+"sessions/:id",{id:"@id"},{update:{method:"PUT"}})}]),angular.module("cCheckApp").controller("AddFightersCtrl",["$scope","fighters","users",function(a,b,c){a.statuses=["Nýliði","Bardagamaður","Bogamaður","Þjálfari"],a.alerts=[],a.newFighter={},a.newFighter.name="",a.newFighter.is_newbie=!0,a.newFighter.is_fighter=!0,a.newFighter.is_archer=!1,a.newUser={},a.newUser.username="",a.newUser.password="1234",a.newUser.email="",a.newUser.groups=[],a.newUser.user_permissions=[],a.load=!1,a.checkAddUser=!1,a.newFighter.user=null,a.dateOptions={formatYear:"yy",startingDay:1},a.addFighter=function(){a.load=!0,a.alerts=[],a.checkAddUser?a.createUserAndFighter():a.createFighter()},a.createFighter=function(c){b.save(a.newFighter).$promise.then(function(b){a.alerts.push({type:"success",msg:a.newFighter.status+" "+b.name+" hefur verið skráður"}),a.checkAddUser&&(a.newFighter.user=c),a.load=!1,a.newFighter.status="Nýliði",a.newFighter.name="",a.checkAddUser=!1},function(b){console.log(b.data),a.alerts.push({type:"danger",msg:"Villa kom upp, athugaðu villuskilaboðin og reyndu aftur: "+JSON.stringify(b.data)}),a.load=!1})},a.createUserAndFighter=function(){c.save(a.newUser).$promise.then(function(b){a.alerts.push({type:"success",msg:"Nýr notandi búinn til, notandanafn: "+b.username}),a.createFighter(b.id),a.newUser.username="",a.newUser.password="1234",a.newUser.email=""},function(){a.alerts.push({type:"danger",msg:"Villa við að búa til notanda eða bardagamann"}),a.load=!1})["finally"](function(){})}}]).controller("AllFightersCtrl",["$scope","fighters","users","$q","ngDialog",function(a,b,c,d,e){a.fighters=b.query(),a.alerts=[],a.statuses=["Nýliði","Bardagamaður","Bogamaður","Þjálfari"],a.oldFighter={},d.all([a.fighters.$promise]).then(function(){a.fighters.forEach(function(a){a.editable=!1})}),a.editUser=function(b){a.editUserFighter=b,e.open({template:"/dialog/editUser.html",scope:a,controller:"AllFightersCtrl"})},a.saveUser=function(){console.log(a.editUserFighter)},a.reset_fighter=function(b){b.name=a.oldFighter.name,b.user=a.oldFighter.user,b.is_newbie=a.oldFighter.is_newbie,b.is_archer=a.oldFighter.is_archer,b.is_fighter=a.oldFighter.is_fighter,b.is_trainer=a.oldFighter.is_trainer,b.can_post_notifications=a.oldFighter.can_post_notifications,b.editable=!1},a.filterStatus=[{status:"Allir",filter:""},{status:"Nýliðar",filter:"Nýliði"},{status:"Bardagamenn",filter:"Bardagamaður"},{status:"Þjálfarar",filter:"Þjálfari"}],a.edit=function(b){b.editable=!0,a.oldFighter=JSON.parse(JSON.stringify(b))},a.save=function(c){var d=c.user;c.user=c.user.id,b.update(c).$promise.then(function(){c.user=d},function(){a.reset_fighter(c)}),c.editable=!1},a.cancel=function(b){a.reset_fighter(b)}}]),angular.module("cCheckApp").controller("AddSessionCtrl",["$scope","fighters","sessions","$q",function(a,b,c,d){a.statuses=[{status:"Allir",filter:""},{status:"Nýliðar",filter:"Nýliði"},{status:"Bardagamenn",filter:"Bardagamaður"},{status:"Bogamenn",filter:"Bogamaður"},{status:"Þjálfarar",filter:"Þjálfari"}],a.types=["Bardagaæfing","Bogaæfing"],a.format="dd.MM.yyyy",a.fighters=b.query(),a.alerts=[],a.load=!1,a.dt=new Date,a.closeAlert=function(b){a.alerts.splice(b,1)},d.all([a.fighters.$promise]).then(function(){a.fighters.forEach(function(a){a.attendance=null})}),a.open=function(b){b.preventDefault(),b.stopPropagation(),a.opened=!0},a.session={},a.session.description="",a.session.session_type="Bardagaæfing",a.session.half_attendance=[],a.session.full_attendance=[],a.registerSession=function(){a.alerts=[],a.session.date=a.dt.toJSON().slice(0,10),a.fighters.forEach(function(b){"full"===b.attendance?a.session.full_attendance.push(b.id):"half"===b.attendance&&a.session.half_attendance.push(b.id)});var b=c.save(a.session);a.load=!0,b.$promise.then(function(b){a.session={},a.session.description="",a.session.half_attendance=[],a.session.full_attendance=[],a.alerts.push({type:"success",msg:"Mæting fyrir "+b.date+" hefur verið skráð. Fjöldi: "+(b.full_attendance.length+b.half_attendance.length)}),a.load=!1},function(b){console.log(b.data),a.alerts.push({type:"danger",msg:"Villa kom upp, athugaðu villuskilaboðin og reyndu aftur: "+JSON.stringify(b.data)}),a.load=!1})}}]).controller("AllSessionsCtrl",["$scope","fighters","sessions","$q",function(a,b,c,d){a.sessions=c.query(),a.fighters=b.query(),d.all([a.sessions.$promise,a.fighters.$promise]).then(function(){a.fighters.forEach(function(b){b.total=0,a.sessions.forEach(function(a){var c=$.grep(a.full_attendance,function(a){return a===b.id});0===c.length?1===$.grep(a.half_attendance,function(a){return a===b.id}).length&&(b.total+=.5):1===c.length&&(b.total+=1)})})},function(){})}]);